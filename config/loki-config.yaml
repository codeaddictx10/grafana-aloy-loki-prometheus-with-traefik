auth_enabled: false

server:
    http_listen_port: 3100
    grpc_listen_port: 9096
    log_level: info
    grpc_server_max_concurrent_streams: 1000
    http_server_read_timeout: 600s
    http_server_write_timeout: 600s

common:
    instance_addr: 0.0.0.0
    path_prefix: /loki
    storage:
        s3:
            bucketnames: ${S3_BUCKET_NAME:-public}
            endpoint: ${S3_ENDPOINT}
            region: ${S3_REGION}
            access_key_id: ${S3_ACCESS_KEY_ID}
            secret_access_key: ${S3_SECRET_ACCESS_KEY}
            insecure: ${S3_INSECURE:-false}
            s3forcepathstyle: ${S3_FORCE_PATH_STYLE:-true}
    replication_factor: 1
    ring:
        kvstore:
            store: inmemory

query_range:
    results_cache:
        cache:
            embedded_cache:
                enabled: true
                max_size_mb: 100

limits_config:
    ingestion_rate_mb: 10
    ingestion_burst_size_mb: 20
    per_stream_rate_limit: 5MB
    per_stream_rate_limit_burst: 15MB

    max_query_parallelism: 32
    max_query_series: 500
    max_query_lookback: 720h

    retention_period: 24h

    metric_aggregation_enabled: true
    allow_structured_metadata: true
    volume_enabled: true

    max_label_name_length: 1024
    max_label_value_length: 2048
    max_label_names_per_series: 30

    cardinality_limit: 100000
    max_streams_per_user: 0
    max_global_streams_per_user: 0

schema_config:
    configs:
        - from: 2020-10-24
          store: tsdb
          object_store: s3
          schema: v13
          index:
              prefix: index_
              period: 24h

pattern_ingester:
    enabled: true
    metric_aggregation:
        loki_address: http://loki:3100

ruler:
    enable_alertmanager_discovery: true
    enable_api: true
    alertmanager_url: http://alertmanager:9093

    storage:
        s3:
            bucketnames: ${S3_BUCKET_NAME:-public}
            endpoint: ${S3_ENDPOINT}
            region: ${S3_REGION}
            access_key_id: ${S3_ACCESS_KEY_ID}
            secret_access_key: ${S3_SECRET_ACCESS_KEY}
            insecure: ${S3_INSECURE:-false}
            s3forcepathstyle: ${S3_FORCE_PATH_STYLE:-true}

    rule_path: /loki/rules-temp
    ring:
        kvstore:
            store: inmemory

frontend:
    encoding: protobuf
    max_outstanding_per_tenant: 2048
    compress_responses: true

query_scheduler:
    max_outstanding_requests_per_tenant: 2048

compactor:
    working_directory: /loki/compactor
    compaction_interval: 10m
    retention_enabled: true
    retention_delete_delay: 2h
    retention_delete_worker_count: 150
    delete_request_store: s3

ingester:
    lifecycler:
        ring:
            kvstore:
                store: inmemory
            replication_factor: 1
    chunk_idle_period: 1h
    chunk_block_size: 262144
    chunk_retain_period: 30s
    max_chunk_age: 1h
    flush_check_period: 30s
    flush_op_timeout: 10m

# REMOVED (not supported for TSDB)
# chunk_store_config:
#   max_look_back_period: 0s

table_manager:
    retention_deletes_enabled: false
    retention_period: 0s

analytics:
    reporting_enabled: false
